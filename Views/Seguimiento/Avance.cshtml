@model WebInventario2._0.Models.SeguimientoModel.SeguimientoResponse

@{
    ViewBag.Title = "Index";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">

<style>
    #myBtn {
        display: none;
        position: fixed;
        bottom: 20px;
        right: 30px;
        z-index: 99;
        font-size: 18px;
        border: none;
        outline: none;
        background-color: #D3D3D3;
        color: #FFF;
        cursor: pointer;
        padding: 10px;
        border-radius: 10px;
    }

    #myBtn:hover {
        background-color: #C0C0C0;
    }
</style>

<button onclick="topFunction()" id="myBtn" title="Ir arriba">
    <svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" fill="currentColor" class="bi bi-arrow-up-square" viewBox="0 0 16 16">
        <path fill-rule="evenodd" d="M15 2a1 1 0 0 0-1-1H2a1 1 0 0 0-1 1v12a1 1 0 0 0 1 1h12a1 1 0 0 0 1-1zM0 2a2 2 0 0 1 2-2h12a2 2 0 0 1 2 2v12a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2zm8.5 9.5a.5.5 0 0 1-1 0V5.707L5.354 7.854a.5.5 0 1 1-.708-.708l3-3a.5.5 0 0 1 .708 0l3 3a.5.5 0 0 1-.708.708L8.5 5.707z" />
    </svg>
</button>

<div style="margin:50px 25px;">
    <div class="col-122">
        <nav>
            <div class="nav nav-tabs" id="nav-tab" role="tablist">
                <a class="nav-item nav-link active" id="nav-home-tab" data-toggle="tab" href="#nav-home" role="tab" aria-controls="nav-home" aria-selected="true">Avance por Zonas</a>
                <a class="nav-item nav-link" id="nav-profile-tab" data-toggle="tab" href="#nav-profile" role="tab" aria-controls="nav-profile" aria-selected="false">Avance por SKU</a>
                <a class="nav-item nav-link" id="nav-contact-tab" data-toggle="tab" href="#nav-contact" role="tab" aria-controls="nav-contact" aria-selected="false">Avance por Piezas</a>
            </div>
        </nav>
        <div class="tab-content" id="nav-tabContent">
            <div class="tab-pane fade show active" id="nav-home" role="tabpanel" aria-labelledby="nav-home-tab">
                <div class="row text-center">
                    <h4>Ubicaciones Piso</h4>
                    @{
                        var listZonaPiso = Model.ListAvanceZonaResponse.Where(m => m.Tipo == "P").Select(m => m.Zona).Distinct().ToList();
                        decimal ubicacionesPiso = Model.ListAvanceZonaResponse.Where(m => m.Tipo == "P").Count();
                        decimal contadasPiso = 0;
                    }

                    @foreach (var itemZona in listZonaPiso.OrderBy(m => m))
                    {
                        <hr class="hr" />

                        foreach (var itemUbicacion in Model.ListAvanceZonaResponse.Where(m => m.Tipo == "P" && m.Zona == itemZona))
                        {
                            <div class="col-1">
                                @if (itemUbicacion.Contada)
                                {
                                    <a href="javascript:void(0);" class="text-white link-underline-white">
                                        <div class="card text-white bg-success mb-3" style="max-width: 14rem;">
                                            <div class="card-header" style="font-size: 9px;">@itemUbicacion.Zona</div>
                                            <div class="card-body" style="font-size: 9px;">@itemUbicacion.Ubicacion</div>
                                        </div>
                                    </a>

                                    contadasPiso++;
                                }
                                else
                                {
                                    <a href="javascript:void(0);" class="text-black link-underline-dark">
                                        <div class="card text-black bg-light mb-3" style="max-width: 14rem;">
                                            <div class="card-header" style="font-size: 9px;">@itemUbicacion.Zona</div>
                                            <div class="card-body" style="font-size: 9px; ">@itemUbicacion.Ubicacion</div>
                                        </div>
                                    </a>
                                }
                            </div>
                        }
                    }
                </div>
                <div class="row text-center">
                    <h4>Ubicaciones Bodega</h4>
                    @{
                        var listZonaDeposito = Model.ListAvanceZonaResponse.Where(m => m.Tipo == "D").Select(m => m.Zona).Distinct().ToList();
                        decimal ubicacionesDeposito = Model.ListAvanceZonaResponse.Where(m => m.Tipo == "D").Count();
                        decimal contadasDeposito = 0;
                    }

                    @foreach (var itemZona in listZonaDeposito.OrderBy(m => m))
                    {
                        <hr class="hr" />

                        foreach (var itemUbicacion in Model.ListAvanceZonaResponse.Where(m => m.Tipo == "D" && m.Zona == itemZona))
                        {
                            <div class="col-1">
                                @if (itemUbicacion.Contada)
                                {
                                    <a href="javascript:void(0);" class="text-white link-underline-white">
                                        <div class="card text-white bg-success mb-3" style="max-width: 14rem;">
                                            <div class="card-header" style="font-size: 9px;">@itemUbicacion.Zona</div>
                                            <div class="card-body" style="font-size: 9px;">@itemUbicacion.Ubicacion</div>
                                        </div>
                                    </a>

                                    contadasDeposito++;
                                }
                                else
                                {
                                    <a href="javascript:void(0);" class="text-black link-underline-dark">
                                        <div class="card text-black bg-light mb-3" style="max-width: 14rem;">
                                            <div class="card-header" style="font-size: 9px;">@itemUbicacion.Zona</div>
                                            <div class="card-body" style="font-size: 9px; ">@itemUbicacion.Ubicacion</div>
                                        </div>
                                    </a>
                                }
                            </div>
                        }
                    }
                    @{
                        decimal avancePiso = (contadasPiso / ubicacionesPiso) * 100; ;
                        decimal avanceDeposito = (contadasDeposito / ubicacionesDeposito) * 100;

                        decimal contadasGlobal = contadasPiso + contadasDeposito;
                        decimal ubicacionesGlobal = ubicacionesPiso + ubicacionesDeposito;

                        decimal avanceGlobal = (contadasGlobal / ubicacionesGlobal) * 100;
                    }
                </div>
                <div class="row text-center">
                    <div style="margin:auto; width: 20%;">
                        <table class="table">
                            <tr>
                                <td align="left"><b>Avance Piso:</b></td>
                                <td align="right">@avancePiso.ToString("0.00")%</td>
                            </tr>
                            <tr>
                                <td align="left"><b>Avance Depósito:</b></td>
                                <td align="right">@avanceDeposito.ToString("0.00")%</td>
                            </tr>
                            <tr>
                                <td align="left"><b>Avance Global:</b></td>
                                <td align="right">@avanceGlobal.ToString("0.00")%</td>
                            </tr>
                        </table>
                    </div>
                </div>
            </div>
            <div class="tab-pane fade" id="nav-profile" role="tabpanel" aria-labelledby="nav-profile-tab">
                <div class="row text-center">
                    @{ 
                        var skuPendientes = Model.TotalSKU - Model.TotalSKUContados;
                    }
                    <h4>Avance por SKU contados</h4>
                    <div class="row text-left">
                        <div style="width: 20%">
                            <table class="table">
                                <tr>
                                    <td align="left"><b>SKU Foto:</b></td>
                                    <td align="right">@string.Format("{0:n0}", Model.TotalSKU)</td>
                                </tr>
                                <tr>
                                    <td align="left"><b>SKU Contados:</b></td>
                                    <td align="right">@string.Format("{0:n0}", Model.TotalSKUContados)</td>
                                </tr>
                                <tr>
                                    <td align="left"><b>SKU Pendientes:</b></td>
                                    <td align="right">@string.Format("{0:n0}", skuPendientes)</td>
                                </tr>
                            </table>
                        </div>
                    </div>
                    <div class="row text-center">
                        <div style="margin:auto; width: 25%;">
                            <canvas id="myChartSKU"></canvas>
                        </div>
                    </div>
                    <div class="row text-center">
                        @*<div><b>Avance Global:</b> avanceGlobal.ToString("0.00")%</div>*@
                    </div>
                </div>
            </div>
            <div class="tab-pane fade" id="nav-contact" role="tabpanel" aria-labelledby="nav-contact-tab">
                <div class="row text-center">
                    @{
                        var piezasPendientes = Model.TotalPiezas - Model.TotalPiezasContadas;
                    }
                    <h4>Avance por Piezas contadas</h4>
                    <div class="row text-left">
                        <div style="width: 20%">
                            <table class="table">
                                <tr>
                                    <td align="left"><b>Piezas Foto:</b></td>
                                    <td align="right">@string.Format("{0:n0}", Model.TotalPiezas)</td>
                                </tr>
                                <tr>
                                    <td align="left"><b>Piezas Contados:</b></td>
                                    <td align="right">@string.Format("{0:n0}", Model.TotalPiezasContadas)</td>
                                </tr>
                                <tr>
                                    <td align="left"><b>Piezas Pendientes:</b></td>
                                    <td align="right">@string.Format("{0:n0}", piezasPendientes)</td>
                                </tr>
                            </table>
                        </div>
                    </div>
                    <div style="margin:auto; width: 25%;">
                        <canvas id="myChartPiezas"></canvas>
                    </div>
                    <div class="row text-center">
                        @*<div><b>Avance Global:</b> avanceGlobal.ToString("0.00")%</div>*@
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script src="https://code.jquery.com/jquery-3.2.1.slim.min.js" integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/popper.js@1.12.9/dist/umd/popper.min.js" integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/js/bootstrap.min.js" integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<script>
    const ctxSKU = document.getElementById('myChartSKU');
    const ctxPiezas = document.getElementById('myChartPiezas');

    new Chart(ctxSKU, {
        type: 'doughnut',
        data: {
            labels: ['SKU Contados', 'SKU Pendientes'],
            datasets: [{
                label: 'Cantidad',
                data: [@Model.TotalSKUContados, @skuPendientes],
                borderWidth: 1
            }]
        },
        options: {
            scales: {
                xAxes: [{
                    display: false
                }],
                yAxes: [{
                    display: false
                }],
            }
        }
    });

    new Chart(ctxPiezas, {
        type: 'doughnut',
        data: {
            labels: ['Piezas Contados', 'Piezas Pendientes'],
            datasets: [{
                label: 'Cantidad',
                data: [@Model.TotalPiezasContadas, @piezasPendientes],
                borderWidth: 1
            }]
        },
        options: {
            scales: {
                xAxes: [{
                    display: false
                }],
                yAxes: [{
                    display: false
                }],
            }
        }
    });

    // Get the button
    let mybutton = document.getElementById("myBtn");

    // When the user scrolls down 20px from the top of the document, show the button
    window.onscroll = function () { scrollFunction() };

    function scrollFunction() {
        if (document.body.scrollTop > 20 || document.documentElement.scrollTop > 20) {
            mybutton.style.display = "block";
        } else {
            mybutton.style.display = "none";
        }
    }

    // When the user clicks on the button, scroll to the top of the document
    function topFunction() {
        document.body.scrollTop = 0;
        document.documentElement.scrollTop = 0;
    }

    $(function () {

    });
</script>
